<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Generator BBCode - Arrest Report (Modern Minimal)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body {
      background-color: #0f1724;
      color: #f8fafc;
      padding: 40px;
      font-family: "Inter", Arial, sans-serif;
    }
    h2 {
      text-align: center;
      font-weight: 700;
      letter-spacing: 0.5px;
      margin-bottom: 30px;
    }
    .form-label {
      font-weight: 600;
      color: #cbd5e1;
    }
/* === Kolom input teks modern dan terbaca === */
.form-control {
  background-color: #111827;      /* warna latar belakang kolom */
  border: 1px solid #334155;      /* warna border netral */
  color: #f9fafb;                 /* warna teks utama (putih terang) */
  border-radius: 8px;
  padding: 10px;
  transition: all 0.2s ease-in-out;
}

/* Warna placeholder biar kontras tapi tidak terlalu mencolok */
.form-control::placeholder {
  color: #9ca3af;                 /* abu-abu muda */
  opacity: 1;
}

/* Saat input difokuskan */
.form-control:focus {
  background-color: #1e293b;      /* sedikit lebih terang saat fokus */
  border-color: #38bdf8;          /* biru terang (seperti PatrolNote) */
  box-shadow: 0 0 0 2px rgba(56,189,248,0.25);
  outline: none;
  color: #ffffff;                 /* pastikan teks tetap putih */
}

    }
    hr {
      border-color: #1e293b;
      margin: 25px 0;
    }
    .upload-row {
      display: flex;
      align-items: center;
      gap: 10px;
      background: #111827;
      padding: 10px 15px;
      border-radius: 10px;
      border: 1px solid #1e293b;
      transition: 0.2s;
    }
    .upload-row:hover {
      border-color: #334155;
      background: #1e293b;
    }
    .thumb {
      width: 58px;
      height: 58px;
      object-fit: cover;
      border-radius: 8px;
      display: none;
      border: 1px solid #334155;
      opacity: 0;
      transition: opacity .25s ease-in;
    }
    .thumb.show {
      display: inline-block;
      opacity: 1;
    }
    .spinner-border {
      width: 1.3rem;
      height: 1.3rem;
      display: none;
      color: #38bdf8;
    }
    .btn-generate {
      background: #047857;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      letter-spacing: 0.3px;
      transition: 0.2s;
    }
    .btn-generate:hover {
      background: #059669;
      transform: translateY(-1px);
    }
    .btn-secondary {
      background: #374151 !important;
      border: none;
      color: #f9fafb;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      letter-spacing: 0.3px;
      transition: 0.2s;
    }
    .btn-secondary:hover {
      background: #4b5563 !important;
      transform: translateY(-1px);
    }
    textarea#result {
      background: #0b1220;
      color: #38bdf8;
      font-family: monospace;
      padding: 15px;
      border-radius: 10px;
      border: 1px solid #334155;
      margin-top: 30px;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
    }
    textarea#result:focus {
      outline: none;
      border-color: #38bdf8;
    }
    /* small responsive tweaks */
    @media (max-width:720px) {
      .upload-row { flex-direction: column; align-items: stretch; gap:8px; }
      .thumb { align-self:flex-end; }
    }
  </style>
</head>
<body class="container">
  <h2>Generator BBCode - Arrest Report</h2>

  <form id="bbcode-form">
    <div class="mb-3"><label class="form-label">Nama Petugas</label><input type="text" class="form-control" id="fullname" required></div>
    <div class="mb-3"><label class="form-label">Badge</label><input type="text" class="form-control" id="serial"></div>
    <div class="mb-3"><label class="form-label">Pangkat</label><input type="text" class="form-control" id="rank"></div>

    <hr>
    <h5 class="mb-3">Unggah Gambar:</h5>

    <div class="mb-3 upload-row">
      <label class="form-label flex-grow-1 mb-0">ID Card</label>
      <input type="file" class="form-control" id="idcardFile" accept="image/*">
      <div class="spinner-border" id="spinner-idcard" role="status"><span class="visually-hidden">Loading...</span></div>
      <img id="thumb-idcard" class="thumb" alt="thumb idcard">
    </div>

    <div class="mb-3 upload-row">
      <label class="form-label flex-grow-1 mb-0">Barang Bukti</label>
      <input type="file" class="form-control" id="evidenceImgFile" accept="image/*">
      <div class="spinner-border" id="spinner-evidence" role="status"><span class="visually-hidden">Loading...</span></div>
      <img id="thumb-evidence" class="thumb" alt="thumb evidence">
    </div>

    <div class="mb-3 upload-row">
      <label class="form-label flex-grow-1 mb-0">Charges (MDC &gt; Crime Record)</label>
      <input type="file" class="form-control" id="chargesFile" accept="image/*">
      <div class="spinner-border" id="spinner-charges" role="status"><span class="visually-hidden">Loading...</span></div>
      <img id="thumb-charges" class="thumb" alt="thumb charges">
    </div>

    <div class="mb-3 upload-row">
      <label class="form-label flex-grow-1 mb-0">MDC Summary</label>
      <input type="file" class="form-control" id="mdcFile" accept="image/*">
      <div class="spinner-border" id="spinner-mdc" role="status"><span class="visually-hidden">Loading...</span></div>
      <img id="thumb-mdc" class="thumb" alt="thumb mdc">
    </div>

    <div class="mb-3 upload-row">
      <label class="form-label flex-grow-1 mb-0">Foto Muka Tersangka (Mugshot)</label>
      <input type="file" class="form-control" id="mugshotFile" accept="image/*">
      <div class="spinner-border" id="spinner-mugshot" role="status"><span class="visually-hidden">Loading...</span></div>
      <img id="thumb-mugshot" class="thumb" alt="thumb mugshot">
    </div>

    <div class="mt-4">
      <button type="button" class="btn-generate" onclick="generateBBCode()" id="generateBtn" disabled>Generate BBCode</button>
      <button type="button" class="btn btn-secondary ms-2" onclick="copyBBCode()">Copy</button>
    </div>
  </form>

  <textarea id="result" rows="28" class="form-control mt-4" readonly></textarea>

  <script>
    const imgurClientId = '894beeef6cd80f4';
    let links = {};

    async function uploadToImgur(file, type) {
      const spinner = document.getElementById(`spinner-${type}`);
      const thumb = document.getElementById(`thumb-${type}`);
      spinner.style.display = 'inline-block';
      thumb.classList.remove('show');
      thumb.style.display = 'none';

      const formData = new FormData();
      formData.append('image', file);

      try {
        const res = await fetch('https://api.imgur.com/3/image', {
          method: 'POST',
          headers: { Authorization: `Client-ID ${imgurClientId}` },
          body: formData
        });
        const data = await res.json();
        spinner.style.display = 'none';

        if (data && data.success) {
          const url = data.data.link;
          links[type] = url;
          thumb.src = url;
          // small delay to ensure image loaded for smooth fade
          thumb.onload = () => {
            thumb.style.display = 'inline-block';
            // trigger CSS transition
            requestAnimationFrame(() => thumb.classList.add('show'));
          };
          checkIfAllUploaded();
        } else {
          Swal.fire('Error', `Upload ${type} gagal.`, 'error');
        }
      } catch (err) {
        spinner.style.display = 'none';
        Swal.fire('Error', `Upload ${type} gagal.`, 'error');
      }
    }

    function checkIfAllUploaded() {
      const required = ["idcard", "evidence", "charges", "mdc", "mugshot"];
      if (required.every(key => links[key])) {
        document.getElementById('generateBtn').disabled = false;
      }
    }

    // Robust mapping: ID in DOM -> logical type
    const uploadMap = [
      { id: 'idcardFile', type: 'idcard' },
      { id: 'evidenceImgFile', type: 'evidence' },   // note: this id must match the input id
      { id: 'chargesFile', type: 'charges' },
      { id: 'mdcFile', type: 'mdc' },
      { id: 'mugshotFile', type: 'mugshot' }
    ];

    function setupAutoUploadByMap() {
      uploadMap.forEach(item => {
        const el = document.getElementById(item.id);
        if (!el) {
          console.warn(`Missing element with id ${item.id}`);
          return;
        }
        el.addEventListener('change', (e) => {
          const file = e.target.files && e.target.files[0];
          if (!file) return;
          // disable input while uploading to avoid race / re-trigger
          e.target.disabled = true;
          uploadToImgur(file, item.type)
            .finally(() => { e.target.disabled = false; });
        });
      });
    }

    // init
    setupAutoUploadByMap();

    function generateBBCode() {
      const name = document.getElementById('fullname').value || '';
      const serial = document.getElementById('serial').value || '';
      const rank = document.getElementById('rank').value || '';

      const bbcode = `[divbox=white]
[align=center][fimg=120,120]https://i.imgur.com/6vMl0Hh.png[/fimg]
[b]SAN ANDREAS POLICE DEPARTMENT
ARREST REPORT[/b][/align]
[hr]
[b]Officer Information[/b]:
[list]
[*][b]Name[/b]: ${name}
[*][b]Badge[/b]: ${serial}
[*][b]Rank[/b]: ${rank}
[/list]
[b]Summary[/b]:
[list]
[*]ID Card
[spoiler][img]${links.idcard || ''}[/img][/spoiler]
[*]Suspect Items
[spoiler][img]${links.evidence || ''}[/img][/spoiler]
[*]Charges (MDC > Crime Record)
[spoiler][img]${links.charges || ''}[/img][/spoiler]
[*]MDC (Summary)
[spoiler][img]${links.mdc || ''}[/img][/spoiler]
[*]Suspect Mugshot
[spoiler][img]${links.mugshot || ''}[/img][/spoiler]
[/list]
[/divbox]`;

      document.getElementById('result').value = bbcode;
    }

    function copyBBCode() {
      const result = document.getElementById('result');
      result.select();
      document.execCommand('copy');
      Swal.fire('Disalin!', 'BBCode telah disalin ke clipboard.', 'success');
    }
  </script>
</body>
<footer class="footer-particle text-center">
  <p>&copy; Generated by <span class="particle-text">Dean Mcdavian</span> & <span class="particle-text">DiamonPanda</span></p>
</footer>
</html>
