<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Generator BBCode - Patrol Note</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 30px; background:#0f1724; color:#fff; }
    input[type="text"], input[type="file"] { background:#111827; border:1px solid #374151; color:#fff; border-radius:4px; padding:8px; }
    .input-row { display:flex; align-items:center; gap:8px; margin-bottom:10px; }
    .btn-generate{ background:#047857; color:#fff; padding:10px 18px; border-radius:6px; border:none; }
    .btn-copy{ background:#374151; color:#fff; padding:10px 18px; border-radius:6px; border:none; }
    textarea{ width:100%; height:280px; margin-top:18px; padding:10px; background:#0b1220; color:#c7d2fe; border:1px solid #334155; border-radius:6px; font-family:monospace; }
    .thumb{ width:56px; height:56px; object-fit:cover; border-radius:6px; border:1px solid #334155; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Generator BBCode - Patrol Note</h2>

    <input id="fullname" type="text" placeholder="Fullname">
    <input id="badge" type="text" placeholder="Badge">
    <input id="rank" type="text" placeholder="Rank">
    <input id="date" type="text" placeholder="Date">
    <input id="timeduty" type="text" placeholder="Time Duty">

    <div style="margin-top:18px;">
      <div class="section-title"><b>Summary of Duties:</b></div>
      <div id="notable-container"></div>
    </div>

    <div style="margin-top:14px;">
      <div class="section-title"><b>Forum Activities:</b></div>
      <div id="forum-container"></div>
    </div>

    <div style="margin-top:18px;">
      <button class="btn-generate" onclick="generateBBCode()">Generate BBCode</button>
      <button class="btn-copy" onclick="copyBBCode()">Copy</button>
    </div>

    <textarea id="output" placeholder="Generated BBCode will appear here..."></textarea>
  </div>

<script>
const IMGUR_CLIENT_ID = '894beeef6cd80f4';

function createNotableRow() {
  const container = document.getElementById('notable-container');

  const row = document.createElement('div');
  row.className = 'input-row';

  const title = document.createElement('input');
  title.type = 'text';
  title.placeholder = 'Title...';

  const fileInput = document.createElement('input');
  fileInput.type = 'file';
  fileInput.accept = 'image/*';

  const spinner = document.createElement('div');
  spinner.className = 'spinner-border text-light';
  spinner.style.display = 'none';
  spinner.style.width = '1.2rem';
  spinner.style.height = '1.2rem';

  const thumb = document.createElement('img');
  thumb.className = 'thumb';
  thumb.style.display = 'none';

  const addBtn = document.createElement('button');
  addBtn.textContent = '+';
  addBtn.onclick = () => createNotableRow();

  const removeBtn = document.createElement('button');
  removeBtn.textContent = 'x';
  removeBtn.onclick = () => {
    if (container.children.length > 1) container.removeChild(row);
  };

  fileInput.addEventListener('change', async () => {
    if (!fileInput.files.length) return;
    spinner.style.display = 'inline-block';
    thumb.style.display = 'none';

    try {
      const uploadedUrl = await uploadToImgur(fileInput.files[0]);
      spinner.style.display = 'none';
      thumb.src = uploadedUrl;
      thumb.style.display = 'inline-block';
      row.dataset.imgurUrl = uploadedUrl;
      Swal.fire({ icon: 'success', title: 'Uploaded!', text: 'Image successfully uploaded to Imgur.' });
    } catch (err) {
      spinner.style.display = 'none';
      console.error(err);
      Swal.fire({ icon: 'error', title: 'Upload failed', text: String(err) });
    }
  });

  row.appendChild(title);
  row.appendChild(fileInput);
  row.appendChild(spinner);
  row.appendChild(thumb);
  row.appendChild(addBtn);
  row.appendChild(removeBtn);

  container.appendChild(row);
}

function createForumRow() {
  const container = document.getElementById('forum-container');
  const row = document.createElement('div');
  row.className = 'input-row';

  const title = document.createElement('input');
  title.type = 'text';
  title.placeholder = 'Title...';

  const link = document.createElement('input');
  link.type = 'text';
  link.placeholder = 'Link to forum...';

  const addBtn = document.createElement('button');
  addBtn.textContent = '+';
  addBtn.onclick = () => createForumRow();

  const removeBtn = document.createElement('button');
  removeBtn.textContent = 'x';
  removeBtn.onclick = () => {
    if (container.children.length > 1) container.removeChild(row);
  };

  row.appendChild(title);
  row.appendChild(link);
  row.appendChild(addBtn);
  row.appendChild(removeBtn);
  container.appendChild(row);
}

async function uploadToImgur(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onerror = () => reject('Gagal membaca file.');
    reader.onload = async () => {
      try {
        const base64 = reader.result.split(',')[1];
        const form = new FormData();
        form.append('image', base64);

        const res = await fetch('https://api.imgur.com/3/image', {
          method: 'POST',
          headers: { Authorization: 'Client-ID ' + IMGUR_CLIENT_ID },
          body: form
        });

        const data = await res.json();
        if (!data.success) reject(data.data.error || 'Unknown error');
        else resolve(data.data.link);
      } catch (e) { reject(e); }
    };
    reader.readAsDataURL(file);
  });
}

function generateBBCode() {
  const fullname = document.getElementById('fullname').value.trim();
  const badge = document.getElementById('badge').value.trim();
  const rank = document.getElementById('rank').value.trim();
  const date = document.getElementById('date').value.trim();
  const timeduty = document.getElementById('timeduty').value.trim();

  let bbcode = `[divbox=white]
[align=center][fimg=120,120]https://i.imgur.com/6vMl0Hh.png[/fimg]
[b]SAN ANDREAS POLICE DEPARTMENT
PATROL NOTE[/b][/align]
[hr]
[b]Officer Information[/b]:
[list]
[*][b]Name[/b]:  ${fullname}
[*][b]Badge[/b]: ${badge}
[*][b]Rank[/b]: ${rank}
[*][b]Date[/b]:  ${date}
[*][b]Time Duty[/b]: ${timeduty}
[/list]\n
[b]Summary of Duties[/b]:\n[list]\n`;

  document.querySelectorAll('#notable-container .input-row').forEach(row => {
    const title = row.querySelector('input[type="text"]').value.trim();
    const link = row.dataset.imgurUrl;
    if (title && link) {
      bbcode += `[*]${title}\n[spoiler][img]${link}[/img][/spoiler]\n`;
    } else if (title) {
      bbcode += `[*]${title}\n`;
    }
  });

  bbcode += `[/list]\n[b]Forum Activities:[/b]\n[list]\n`;
  document.querySelectorAll('#forum-container .input-row').forEach(row => {
    const title = row.children[0].value.trim();
    const link = row.children[1].value.trim();
    if (title && link) bbcode += `[*][url=${link}]${title}[/url]\n`;
  });

  bbcode += `[/list]\n[/divbox]`;

  document.getElementById('output').value = bbcode;
}

function copyBBCode() {
  const output = document.getElementById('output');
  output.select();
  document.execCommand('copy');
  Swal.fire({ icon:'success', title:'Copied', text:'BBCode copied to clipboard.' });
}

window.onload = () => {
  createNotableRow();
  createForumRow();
};
</script>
</body>
<footer class="footer-particle text-center">
  <p>&copy; Generated by <span class="particle-text">Dean Mcdavian</span> & <span class="particle-text">DiamonPanda</span></p>
</footer>
</html>
